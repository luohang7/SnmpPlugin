# Auto generated by LangBot Plugin SDK.
# Please refer to https://docs.langbot.app/en/plugin/dev/tutor.html for more details.
from __future__ import annotations

from langbot_plugin.api.definition.components.common.event_listener import EventListener
from langbot_plugin.api.entities import events, context
import logging

# è®¾ç½®æ—¥å¿—
logger = logging.getLogger(__name__)


class DefaultEventListener(EventListener):

    async def initialize(self):
        await super().initialize()
        logger.info("SNMP Trap EventListener åˆå§‹åŒ–å®Œæˆ")

    async def on_event(self, event: events.Event, ctx: context.EventContext):
        """
        å¤„ç†æ‰€æœ‰äº‹ä»¶ï¼Œç”¨äºè°ƒè¯•å’Œæ•°æ®æ ¼å¼åˆ†æ
        """
        logger.info(f"æ¥æ”¶åˆ°äº‹ä»¶: {type(event).__name__}")
        logger.info(f"äº‹ä»¶æ•°æ®: {event}")

        # æ£€æŸ¥æ˜¯å¦ä¸ºç½‘ç»œç›¸å…³äº‹ä»¶
        event_data = {
            "event_type": type(event).__name__,
            "event_content": str(event),
            "timestamp": ctx.current_time
        }

        # æ‰“å°äº‹ä»¶è¯¦ç»†ä¿¡æ¯
        print("="*50)
        print("ğŸ” æ¥æ”¶åˆ°æ–°äº‹ä»¶:")
        print(f"ç±»å‹: {event_data['event_type']}")
        print(f"å†…å®¹: {event_data['event_content']}")
        print(f"æ—¶é—´: {event_data['timestamp']}")
        print("="*50)

        # æ£€æŸ¥æ˜¯å¦æœ‰ SNMP ç›¸å…³çš„äº‹ä»¶
        event_str = str(event).lower()
        if any(keyword in event_str for keyword in ['snmp', 'trap', 'network', 'alert', 'oid']):
            print("ğŸš¨ æ£€æµ‹åˆ°å¯èƒ½çš„ SNMP ç›¸å…³äº‹ä»¶!")
            print(f"è¯¦ç»†å†…å®¹: {event}")
            print("="*50)

        # è°ƒç”¨çˆ¶ç±»æ–¹æ³•
        await super().on_event(event, ctx)